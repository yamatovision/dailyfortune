# チーム相性（Aisyou）機能要件定義書

## 1. 概要

チームメンバー間の四柱推命に基づく相性を可視化し、より良いコミュニケーションや協業をサポートするための「チーム相性（Aisyou）」機能を実装する。この機能は独立したページとして提供され、ユーザーは自分とチームメンバー間の相性を確認できる。

## 2. 目的

- チームメンバー間の相性を四柱推命に基づいて可視化する
- メンバー間のコミュニケーションや協業の質を向上させる
- 日々の運勢ランキングを表示してチーム内のエンゲージメントを高める
- メンバー間の理解を深め、チームワークを促進する

## 3. 機能要件

### 3.1 ページ基本構成

- 既存の `/team` ページとは独立した新しいページとして実装
- URL: `/aisyou` または `/team/compatibility`
- レスポンシブデザイン対応（スマートフォン/タブレット/PC）
- 主要コンポーネント：
  - ヘッダー（タイトル、ユーザーメニュー）
  - 今日の運勢ランキングセクション
  - チームメンバーリスト
  - 相性詳細モーダル
  - フッターナビゲーション

### 3.2 今日の運勢ランキング

- チームメンバーの今日の運勢をランキング形式で表示
- 表示項目：
  - 順位（1位〜5位）
  - ユーザー名
  - 役割（エンジニア、デザイナーなど）
  - 五行属性（水、火、土、金、木）
  - 運勢スコア（0-100点）
  - ラッキーアイテム
- 自分自身のランキングを強調表示
- 毎日3時に更新される旨を表示

### 3.3 チームメンバーリスト

- チーム内の全メンバーをカード形式でリスト表示
- 表示項目：
  - ユーザー名
  - 役割（エンジニア、デザイナーなど）
  - 五行属性
  - 「相性を見る」ボタン
- 五行属性に応じたカラーコーディング：
  - 水：青系
  - 火：赤系
  - 土：黄土色系
  - 金：金色/シルバー系
  - 木：緑系

### 3.4 相性詳細モーダル

- メンバーリストから「相性を見る」ボタンをクリックで表示
- 表示項目：
  - 相手ユーザーの基本情報（名前、役割、五行属性）
  - 自分と相手の五行関係（相生・相克・中和のいずれか）
  - 相性の詳細説明（AIによる生成コンテンツ、マークダウン形式）
  - 「相談する」ボタン（※チャット機能連携用・現時点では未実装）

### 3.5 相性情報

- 相性は次の3種類に分類：
  - 相生（互いを生かす関係）：五行の相生関係
  - 中和（互いに干渉しない関係）：五行の直接関係がない場合
  - 相克（互いに抑制する関係）：五行の相克関係
- 相性説明は視点依存：
  - AさんからみたBさんの相性
  - BさんからみたAさんの相性
- 説明内容には以下を含む：
  - 性格特性の相互作用
  - 協業のポイント
  - コミュニケーション上の注意点
  - チームにおける相補的な役割

## 4. 技術要件

### 4.1 フロントエンド

- React + TypeScriptで実装
- MUIコンポーネントライブラリを使用
- モバイルファーストのレスポンシブデザイン
- アニメーション効果の適用（ページ遷移、モーダル表示など）

### 4.2 バックエンド

- 既存のAPIエンドポイントを活用
- 相性計算は初回時のみ実行し、結果をデータベースに保存
- パフォーマンス最適化のためのキャッシュ戦略

### 4.3 データモデル

#### 4.3.1 Compatibility（相性）モデル

```typescript
interface ICompatibility {
  user1Id: string;
  user2Id: string;
  compatibilityScore: number;
  relationship: 'mutual_generation' | 'mutual_restriction' | 'neutral';
  relationshipType?: '相生' | '相克' | '中和';
  user1Element: 'wood' | 'fire' | 'earth' | 'metal' | 'water';
  user2Element: 'wood' | 'fire' | 'earth' | 'metal' | 'water';
  detailDescription: string;
  teamInsight?: string;
  collaborationTips?: string[];
  createdAt: Date;
  updatedAt: Date;
}
```

### 4.4 APIエンドポイント

| メソッド | エンドポイント | 説明 |
|---------|--------------|------|
| GET | `/api/v1/teams/:teamId/members` | チームメンバー一覧の取得 |
| GET | `/api/v1/fortune/team/:teamId/ranking` | チーム内の運勢ランキング取得 |
| GET | `/api/v1/teams/:teamId/compatibility/:userId1/:userId2` | メンバー相性情報の取得 |
| GET | `/api/v1/users/:userId` | ユーザー基本情報の取得 |

## 5. 非機能要件

### 5.1 パフォーマンス

- 初期ページロード：2秒以内
- 相性情報取得：1秒以内
- 運勢ランキング取得：1秒以内

### 5.2 セキュリティ

- チームメンバーのみが当該チームの相性情報にアクセス可能
- API認証と権限チェックの徹底

### 5.3 キャッシュ戦略

- 相性情報：四柱推命データ更新時のみ再計算
- 運勢ランキング：日次更新（午前3時）

## 6. 実装スケジュール

1. データモデル設計と実装：1日
2. APIエンドポイント実装：2日
3. フロントエンドUI実装：3日
4. テストとデバッグ：1日
5. リリース：0.5日

合計：約7.5日

## 7. 将来的な拡張案

- 相性に基づくチーム編成の提案機能
- 相性グラフの視覚化（チーム全体の相性マップ）
- 時間軸での相性変化の追跡
- 相性を考慮したプロジェクトアサイン最適化
- 「相談する」ボタンと連携したAIチャット機能

## 8. 関連ドキュメント

- API仕様書：`/docs/api/aisyou.md`
- UI/UXデザインモックアップ：`/mockups/aisyou.html`
- データモデル設計：`/docs/data_models.md`

## 9. 注意事項

- 相性情報は参考情報として提供され、絶対的な評価ではない旨をユーザーに明示
- 五行属性に基づく相性は文化的背景を持つことに配慮
- プライバシーに配慮し、センシティブな情報は含めない
- 肯定的なフィードバックを中心に、建設的な関係構築を促進する内容設計