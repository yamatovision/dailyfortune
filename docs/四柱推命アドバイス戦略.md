# 四柱推命アドバイス戦略

このドキュメントでは、DailyFortuneアプリケーションにおいて、四柱推命データを使用した各種アドバイス生成のためのデータ構造と戦略を定義します。新たに実装された格局（気質タイプ）と用神（運気を高める要素）の情報を活用して、より精度の高いパーソナライズされたアドバイスを提供することを目的としています。

## 1. 個人の日々の運勢アドバイス

### 1.1 送信データ構造（JSON）

```json
{
  "user": {
    "name": "山田太郎",
    "fourPillars": {
      "year": { "stem": "甲", "branch": "寅" },
      "month": { "stem": "丙", "branch": "午" },
      "day": { "stem": "乙", "branch": "卯" },
      "hour": { "stem": "丁", "branch": "未" }
    },
    "mainElement": "木",
    "secondaryElement": "火",
    "kakukyoku": {
      "type": "従旺格",
      "strength": "strong",
      "category": "special",
      "description": "主体性があり、自分の思った通りに人生を突き進む気質タイプです。自己主張が強く、リーダーシップがある一方、協調性を意識する必要があります。"
    },
    "yojin": {
      "tenGod": "食神",
      "element": "火",
      "supportElements": ["火", "木"],
      "description": "あなたの用神は「食神（火）」です。身強の状態なので、火の力で日干を抑制し、バランスを取ることが運気の鍵となります。創造性を発揮し、表現力を高めることであなたの運気が向上します。"
    },
    "goals": ["プロジェクト完了", "健康増進", "人間関係改善"]
  },
  "targetDate": {
    "date": "2025-07-15",
    "dayPillar": { "stem": "壬", "branch": "午" },
    "tenGodRelationToUser": "偏官",
    "elementRelationToYojin": "克", // 相生, 相剋, 比和, 同和
    "dayFortuneRating": 75 // 0-100スケール
  },
  "requestFocus": [
    "仕事面のアドバイス",
    "対人関係のアドバイス",
    "健康面のアドバイス",
    "全体運勢の総合評価"
  ]
}
```

### 1.2 アドバイス生成戦略

1. **身強・身弱に基づく基本アプローチ**
   - 身強の場合：日干を抑制する要素を重視したアドバイス
   - 身弱の場合：日干を強化する要素を重視したアドバイス
   - 中和の場合：バランスを維持する要素を重視したアドバイス

2. **用神との相性**
   - 対象日の天干地支が用神と相生関係にある場合は運気良好と判断
   - 対象日の天干地支が用神と相剋関係にある場合は注意を促す
   - 対象日の天干地支が用神と同じ場合は特に強調

3. **格局タイプ別のアドバイス**
   - 特別格局（従旺格、従財格など）には専用のアドバイスパターン
   - 普通格局には一般的なアドバイスに格局特性を加味

4. **具体的なアドバイス構成**
   - 全体運：対象日のキーワードと総合評価（3-5星）
   - 仕事運：具体的なアドバイス1-2点（用神活用法を含む）
   - 人間関係：相性の良い人物の特徴（十神や五行で示唆）
   - ラッキーアイテム：用神の五行に関連したもの

## 2. チームメンバー相性分析

### 2.1 送信データ構造（JSON）

```json
{
  "members": [
    {
      "name": "鈴木リーダー",
      "fourPillars": {
        "year": { "stem": "甲", "branch": "寅" },
        "month": { "stem": "丙", "branch": "午" },
        "day": { "stem": "乙", "branch": "卯" },
        "hour": { "stem": "丁", "branch": "未" }
      },
      "mainElement": "木",
      "kakukyoku": {
        "type": "従旺格",
        "strength": "strong",
        "category": "special"
      },
      "yojin": {
        "tenGod": "食神",
        "element": "火"
      },
      "role": "プロジェクトリーダー"
    },
    {
      "name": "佐藤メンバー",
      "fourPillars": {
        "year": { "stem": "戊", "branch": "申" },
        "month": { "stem": "庚", "branch": "戌" },
        "day": { "stem": "辛", "branch": "酉" },
        "hour": { "stem": "壬", "branch": "子" }
      },
      "mainElement": "金",
      "kakukyoku": {
        "type": "従財格",
        "strength": "weak",
        "category": "special"
      },
      "yojin": {
        "tenGod": "比肩",
        "element": "金"
      },
      "role": "エンジニア"
    }
  ],
  "relationshipAnalysis": {
    "dayPillarRelation": "辛酉-乙卯", // 日柱の組み合わせ
    "dayMasterTenGod": "偏官", // メンバー2から見たメンバー1の十神関係
    "elementInteraction": "相剋", // 五行の基本関係
    "kakukyokuCompatibility": "補完", // 格局同士の相性（補完/競合/中立）
    "yojinInteraction": "相生" // 用神同士の関係
  },
  "requestFocus": [
    "業務上の協力パターン",
    "コミュニケーション改善策",
    "潜在的な対立ポイントと解決法",
    "相互の強みを活かした役割提案"
  ]
}
```

### 2.2 相性分析戦略

1. **日主（日柱天干）の相互関係分析**
   - 十神関係に基づく基本的な相性（比肩は協力的、偏官は指導・管理など）
   - 日主の陰陽一致度（同性は理解しやすく、異性は補完的）

2. **格局タイプの組み合わせ分析**
   - 補完的組み合わせ：異なる強みを持つ格局同士（例：従旺格と従財格）
   - 強化的組み合わせ：類似した特性の格局同士（例：食神格と傷官格）
   - 挑戦的組み合わせ：競合しやすい格局同士（例：従旺格と従旺格）

3. **用神の相互作用**
   - 用神同士が相生関係：協力しやすい
   - 用神同士が相剋関係：刺激し合う関係
   - 用神が同じ：同じ方向性を持つが競合の可能性

4. **具体的なアドバイス方針**
   - 相性レベル評価：★〜★★★★★（5段階）
   - 強みを活かした役割分担の提案
   - コミュニケーションのポイント（例：「〇〇さんは△△の説明を好む」）
   - 潜在的な摩擦ポイントと対応策

## 3. チーム目標達成・経営判断

### 3.1 送信データ構造（JSON）

```json
{
  "teamGoal": "第3四半期の売上目標達成",
  "period": "2025-07-01 to 2025-09-30",
  "coreMembers": [
    {
      "name": "鈴木リーダー",
      "fourPillars": {
        "year": { "stem": "甲", "branch": "寅" },
        "month": { "stem": "丙", "branch": "午" },
        "day": { "stem": "乙", "branch": "卯" },
        "hour": { "stem": "丁", "branch": "未" }
      },
      "mainElement": "木",
      "kakukyoku": {
        "type": "従旺格",
        "strength": "strong",
        "category": "special"
      },
      "yojin": {
        "tenGod": "食神",
        "element": "火"
      },
      "role": "リーダー"
    },
    {
      "name": "佐藤メンバー",
      "fourPillars": {
        "year": { "stem": "戊", "branch": "申" },
        "month": { "stem": "庚", "branch": "戌" },
        "day": { "stem": "辛", "branch": "酉" },
        "hour": { "stem": "壬", "branch": "子" }
      },
      "mainElement": "金",
      "kakukyoku": {
        "type": "従財格",
        "strength": "weak",
        "category": "special"
      },
      "yojin": {
        "tenGod": "比肩",
        "element": "金"
      },
      "role": "営業担当"
    },
    {
      "name": "高橋メンバー",
      "fourPillars": {
        "year": { "stem": "癸", "branch": "亥" },
        "month": { "stem": "甲", "branch": "子" },
        "day": { "stem": "丁", "branch": "巳" },
        "hour": { "stem": "乙", "branch": "卯" }
      },
      "mainElement": "火",
      "kakukyoku": {
        "type": "正官格",
        "strength": "strong",
        "category": "normal"
      },
      "yojin": {
        "tenGod": "偏財",
        "element": "金"
      },
      "role": "分析担当"
    }
  ],
  "teamElementBalance": {
    "wood": 1,
    "fire": 1,
    "earth": 0,
    "metal": 1,
    "water": 0
  },
  "projectPeriodPillars": {
    "year": { "stem": "乙", "branch": "巳" },
    "months": [
      { "stem": "戊", "branch": "申" },
      { "stem": "己", "branch": "酉" },
      { "stem": "庚", "branch": "戌" }
    ]
  },
  "requestFocus": [
    "チーム内のコミュニケーション改善",
    "メンバーの強みを活かした役割分担",
    "目標達成のための時期別アドバイス",
    "チーム全体としての弱点と対策"
  ]
}
```

### 3.2 チーム目標達成・経営判断アドバイス戦略

1. **チーム構成の五行バランス分析**
   - チーム全体の五行分布と不足要素の特定
   - 各メンバーの格局と用神の相互補完性評価
   - 全体としての「身強」「身弱」傾向判断

2. **プロジェクト期間の天干地支との相性**
   - 期間中の天干地支とチームメンバーの用神との相性分析
   - 有利な時期と注意が必要な時期の特定
   - 月ごとの運気変動に応じた戦略提案

3. **格局タイプに基づく役割最適化**
   - 各メンバーの格局特性に最適な役割の提案
   - リーダーシップの適性（従旺格、建禄格など）
   - 分析・創造・実行など各フェーズでの適任者特定

4. **具体的なアドバイス内容**
   - チーム運営の全体的な方針提案
   - 各期間（月別など）の注力ポイント
   - 具体的な役割分担案と協力パターン
   - チームのリスク要因と対策
   - 成功確率を高めるための環境調整案

## 4. データ渡し方の実装ガイドライン

### 4.1 データ軽量化戦略

利用シーンによっては、完全なデータではなく必要最小限のデータに絞ることで処理効率を高めることができます：

**最小構成データセット**:
```json
{
  "user": {
    "mainElement": "木",
    "kakukyoku": {
      "type": "従旺格",
      "strength": "strong"
    },
    "yojin": {
      "tenGod": "食神",
      "element": "火"
    }
  },
  "targetDate": {
    "dayPillar": { "stem": "壬", "branch": "午" }
  }
}
```

### 4.2 API実装の考慮点

1. **バックエンドでのコンテキスト構築**
   - ユーザーIDから必要な四柱推命データを取得
   - 日付から該当する天干地支情報を取得
   - Claude APIに送信するJSONを構築

2. **キャッシュ戦略**
   - 個人の基本データ（四柱・格局・用神）をキャッシュ
   - 日々の運勢は日付単位でキャッシュ
   - チーム相性分析は長期キャッシュ可能

3. **エラーハンドリング**
   - 四柱推命データが不完全な場合のフォールバック
   - Claude APIのレスポンスタイムアウト対策
   - 結果のバリデーション

### 4.3 レスポンスフォーマット標準化

Claude APIからのレスポンスを以下のようなフォーマットで標準化することで、フロントエンドでの表示を容易にします：

```json
{
  "summary": "今日は創造性を活かす日です。食神の力が強まります。",
  "rating": 4,
  "aspects": [
    {
      "category": "仕事運",
      "text": "創造的な提案が評価される日です。用神の火のエネルギーを活かして表現力を発揮しましょう。",
      "rating": 4,
      "keywords": ["創造性", "表現", "評価"]
    },
    {
      "category": "対人運",
      "text": "リーダーシップを発揮できますが、身強の傾向があるため、他者の意見にも耳を傾けると良い結果につながります。",
      "rating": 3,
      "keywords": ["リーダーシップ", "傾聴", "協力"]
    },
    {
      "category": "健康運",
      "text": "エネルギーレベルは高めですが、使いすぎに注意。特に目や肝臓系のケアを。",
      "rating": 3,
      "keywords": ["高エネルギー", "目のケア", "適度な休息"]
    }
  ],
  "advice": [
    "今日は創造的なプロジェクトに取り組むのに最適です",
    "食神（火）の力を活かすため、赤色のアイテムを身につけると運気アップ",
    "身強のバランスを取るため、静かな時間も確保しましょう"
  ],
  "luckyItems": [
    { "category": "color", "item": "赤", "element": "火" },
    { "category": "direction", "item": "南", "element": "火" },
    { "category": "food", "item": "トマト", "element": "火" }
  ]
}
```

## 5. 実装ロードマップ

### Phase 1: 基本データ構造の実装
- 格局・用神データのモデル定義
- 天干地支と日付の変換システム
- ユーザープロフィールへのデータ追加

### Phase 2: 個人運勢アドバイス
- 日々の運勢生成API実装
- Claude APIとの連携
- フロントエンドでの表示実装

### Phase 3: 相性分析機能
- メンバー間相性分析ロジック
- チーム分析機能
- 相性データのビジュアライゼーション

### Phase 4: 高度な分析機能
- 期間別運勢予測
- 目標達成戦略アドバイス
- ダッシュボード統合

## 6. まとめ

格局と用神を中心とした四柱推命データを活用することで、DailyFortuneアプリケーションはより精度の高いパーソナライズされたアドバイスを提供できるようになります。これらのデータを適切に構造化してClaudeに送信することで、ユーザーは自分自身の特性をより深く理解し、日々の判断やチーム運営に活かすことができるでしょう。

本戦略に基づいた実装により、単なる占いアプリを超えた、実用的な自己理解・チーム理解のツールとしての価値を提供することが可能になります。