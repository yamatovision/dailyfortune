# エンティティ関係分析と実装タスク分解プロンプト

## 指示

あなたはシステム設計と実装順序の専門家として、データモデルとビジネスロジックを分析し、最適な実装順序とタスク分解を行ってください。以下のステップに従って分析と計画を行い、具体的かつ実行可能なタスクリストを作成してください。

## 分析ステップ

### 1. データモデル関係の分析
- 提供されたエンティティ（データモデル）の定義を読み解いてください
- 各エンティティ間の参照関係（外部キー関係）を特定してください
- エンティティ依存グラフを作成し、依存方向を明確な矢印で示してください

### 2. ビジネスロジック依存関係の分析
- 各機能の詳細な処理内容とデータフローを把握してください
- **重要**: モデル間の外部キー参照だけでなく、ビジネスロジック上の依存関係も特定してください
  - 例: 運勢生成には、ユーザープロフィール、日柱情報、ユーザー目標、チーム目標のデータが必要
- 機能依存グラフを作成し、データが実際にどのように利用されるかを示してください

### 3. 外部サービス連携の分析
- 外部APIやサービスとの連携ポイントを特定してください
- データの流れとトランスフォーメーションを記述してください
- 依存関係グラフに外部サービスを含めてください

### 4. フロントエンド要件の分析
- UIコンポーネントとバックエンドAPIの関係を特定してください
- 各画面で必要なデータと操作を特定し、対応するAPIエンドポイントを計画してください
- フロントエンド専用の依存関係グラフを作成してください

## 統合依存グラフの作成

上記の分析を統合し、総合的な依存関係グラフを作成してください。この統合グラフには、以下の情報を明確に示してください：

1. **データモデル依存関係**: 通常の矢印で表示（例: `A → B` はAがBを参照）
2. **ビジネスロジック依存関係**: 点線の矢印で表示（例: `A ---> B` はAの処理にBのデータが必要）
3. **外部サービス依存関係**: 波線の矢印で表示（例: `A ~~~> Service` はAが外部サービスに依存）
4. **フロントエンド依存関係**: 二重線矢印で表示（例: `Component ==> API` はコンポーネントがAPIを呼び出す）

## 実装タスクのブレークダウン

統合依存グラフに基づいて、以下の実装タスクリストを作成してください：

1. **フェーズ分け**: 依存関係の順序に従って明確なフェーズに分割
2. **エンティティごとのタスク**: 各エンティティについて必要な実装タスク
   - モデル実装
   - サービス層（ビジネスロジック）
   - コントローラー（APIエンドポイント）
   - ルーティング設定
   - ユニットテスト
3. **外部サービス連携タスク**: 外部サービスとの連携に必要なタスク
4. **バッチ処理タスク**: 定期実行や非同期処理に関するタスク
5. **フロントエンドタスク**: UI実装に関するタスク
   - コンポーネント実装
   - ページ実装
   - API連携サービス実装

## 特別な考慮事項

1. **循環依存関係の識別と対処法の提案**
   - 循環依存を特定したら、これを解消する方法を提案してください
   - 例: 中間テーブルの導入、インターフェース分離など

2. **バッチ処理と自動化の分析**
   - システムの自動化ポイントを特定してください
   - バッチ処理の実行順序と依存関係を明確にしてください

3. **並行開発可能な領域の特定**
   - 依存関係に基づいて並行開発が可能なタスクグループを特定してください
   - フロントエンドとバックエンドの並行開発戦略を提案してください

4. **リスク評価**
   - 実装順序の中でリスクが高い部分を特定してください
   - 複雑な依存関係を持つコンポーネントには特に注意してください

## 出力形式

以下の形式で出力してください：

1. **統合依存関係グラフ**: 図を用いて（テキストベースの図も可）、上記で説明した表記法で依存関係を明示
2. **実装フェーズ一覧**: 依存関係に基づいた論理的なフェーズ分け
3. **詳細タスクリスト**: 各フェーズ内のタスクを詳細に列挙
4. **並行開発可能なタスクグループ**: 同時に進められるタスクのグループ化
5. **リスク評価とミティゲーション戦略**: 実装時に注意すべきポイントと対策

## 具体的なプロジェクト情報

以下のプロジェクト情報に基づいて分析を行ってください：

1. **データモデル**:
   - [提供されたデータモデル情報・図をここに挿入]

2. **ビジネスロジック要件**:
   - [機能要件や処理フローの説明をここに挿入]

3. **外部サービス連携**:
   - [外部APIやサービスとの連携情報をここに挿入]

4. **技術スタック**:
   - [使用する技術やライブラリ情報をここに挿入]

## 重要な注意点

- 単なるデータモデルの参照関係だけでなく、**ビジネスロジックの流れ**を重視してください
- ある機能が他の機能のデータに依存する場合、その依存関係を明確に示してください
- 実装順序は「できるだけ早く動くプロトタイプを作る」という観点ではなく「依存関係に基づく論理的な実装順序」を優先してください
- 分析の過程で不明点や追加情報が必要な場合は、質問してください
- タスク分解は、1人の開発者が実装する場合でも追跡可能な粒度にしてください（目安: 1タスク = 0.5〜2日）