# AppGenius複数AIエージェント開発方法論

## 概要

本ドキュメントでは、複数AIによる効率的な開発プロセスとシステムの全体像について解説します。このアプローチは、要件定義から実装、テスト、デプロイまでの一連の流れを体系化し、モックアップ主導の開発と複数AIの連携による高品質なソフトウェア開発を実現します。

## 開発プロセスの全体像

複数AIエージェントによる開発は、以下のステップで進められます：

```
#1: 要件定義をAIと決める
#2: 基本的なシステムアーキテクチャを設計
#3: モックアップを作成し要件定義をさらに固める
#4: 技術スタックとインフラを選定
#5: データモデルを詳細に設計
#6: 環境変数を設定し実際のエンドポイントと接続する基盤を作る
#7: 認証システムの実装と初期デプロイ
#8: CI/CDパイプラインとテスト環境の構築

【反復開発サイクル - 機能ごとに繰り返し】
#9: 実装優先順位に基づく次の機能スコープ選定
#10: 機能のテストケース作成
#11: 機能の実装（バックエンド→フロントエンド統合）
#12: テスト実行とデバッグ
#13: 機能をCICD経由でステージング環境にデプロイ
#14: 機能完了後のGitHubへのマージと文書更新
#15: #9に戻り次の機能へ

【プロジェクト完了フェーズ】
#16: 最終的な統合テストと品質保証
#17: 本番環境へのデプロイと引き継ぎ文書作成
```

このプロセスをサポートするために、特化した役割を持つAIプロンプトを使用します。

## AIアシスタントの役割

各ステップには専門のAIプロンプトが用意されており、異なる役割を担当します：

### 1. 要件定義 (★1requirements_creator)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/cdc2b284c05ebaae2bc9eb1f3047aa39

- **目的**: 非技術者のビジネス要件を具体的な要件定義書に変換
- **プロセス**:
  - 新規か既存プロジェクトかを判別（Phase#0）
  - プロジェクト情報収集（業界、ターゲットユーザー、競合）
  - 機能要件の策定（コア機能、必須/追加機能の区別）
  - 必要ページの洗い出し（各ページの説明と主要機能）
  - 構造化された要件定義書の作成
- **成果物**: 
  - `docs/requirements.md` - 包括的な要件定義書
  - プロジェクト概要、目標とゴール、ターゲットユーザー、機能要件、非機能要件
  - ページリスト（各ページの説明と主要機能）
  - 初期データモデル、制約条件、マイルストーン

### 2. システムアーキテクチャ設計 (★2system_architecture)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/9575d0837e6b7700ab2f8887a5c4faec
- **目的**: 要件からシステム全体の設計を行い、開発基盤を確立する
- **プロセス**:
  - 要件定義書の分析
  - 基本プロジェクト構造とディレクトリ構造の設計
  - データモデルとAPI定義の一元管理アプローチ確立
  - 技術スタック選定（フロントエンド/バックエンド）
  - インフラストラクチャとデプロイ戦略設計
  - 環境変数の設計と管理戦略
- **成果物**:
  - `docs/CURRENT_STATUS.md` - プロジェクト全体の構造を定義
  - `shared/index.ts` - 共有型定義・APIパス定義ファイル
  - `server/src/types/index.ts` - バックエンド用型定義ファイル（共有定義のコピー）
  - `docs/deploy.md` - インフラとデプロイ戦略（環境設計、CI/CD設計など）
  - `.env` - 環境変数テンプレート（プロジェクトルート）

### 3. モックアップ作成とデータモデル分析 (★3mockup_creatorandanalyzer)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/8cdfe9875a5ab58ea5cdef0ba52ed8eb
- **目的**: 要件定義に基づいた視覚的なモックアップ作成とデータ分析
- **プロセス**:
  - 要件からページを選択し、完全なHTMLモックアップを作成（Phase#1）
  - ユーザーフィードバックに基づく改善（Phase#2）
  - データモデル分析、API仕様と実装ガイドの生成（Phase#3）
  - シンプルさを重視し、不要な複雑性を排除
- **成果物**: 
  - `mockups/[ページ名].html` - 機能的なHTMLモックアップファイル
  - `docs/data_models/[ページ名].md` - データモデル分析（エンティティ関係図、データ構造など）
  - `docs/api/[カテゴリ名].md` - 機能カテゴリ別のAPI仕様書（エンドポイント定義、リクエスト/レスポンス型定義）
  - `docs/ui/[ページ名].md` - UI設計と状態管理ガイド（コンポーネント構成、データフロー）
  - `docs/implementation/[ページ名].md` - 実装ガイド（フロントエンド/バックエンド実装の注意点）
  - `shared/index.ts` への型定義とAPIパス定義の追加

### 4. データモデル統合 (★4data_model_assistant_generic)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/f0f6805b80ae32f3846c35fe9df4eefe
- **目的**: 個別ページのデータモデルを統合し、シンプルで一貫性のあるシステム全体のモデルを構築
- **プロセス**:
  - 個別モデルの収集と分析（フェーズ1）
    - 各ページのデータモデルの収集と一覧化
    - 同一または類似エンティティの識別
    - 矛盾点や不整合の特定
  - 統合データモデルの構築（フェーズ2）
    - コアエンティティの統一定義
    - 重複する概念や属性の統合・標準化
    - 統一された命名規則の適用
  - 依存関係の最適化（フェーズ3）
    - 全エンティティ間の依存関係マップ作成
    - 循環参照の検出と解決
    - 依存方向の最適化
  - システム全体の統合モデルの文書化（フェーズ4）
- **成果物**: 
  - `docs/data_models/integrated_model.md` - 統合データモデルドキュメント（全エンティティの定義と関係性）
  - `docs/data_models/erd.md` - エンティティ関係図
  - `shared/index.ts` への型定義 - TypeScript型定義
  - `server/src/models/` への実装例 - 主要エンティティのMongooseスキーマ実装例

### 5. データモデル精査と実装 (★5tukkomi)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/bbc6e76a5f448e02bea16918fa1dc9ad
- **目的**: 統合データモデルを厳格に精査し、実装と品質を高める
- **プロセス**:
  - 統合モデルの調査と理解（フェーズ1）
    - 統合データモデル、ERD、モックアップファイル、要件定義、型定義の調査
    - 不明点や不足情報の明確化
  - 統合データモデル精査（フェーズ2）
    - シンプル化と核心機能への集中（不要なエンティティや属性の特定）
    - 一貫性とデータ整合性の検証
    - 依存関係と循環参照の問題発見
    - 実装上の懸念点の特定
    - ユーザーエクスペリエンスとビジネス要件の観点からの検証
  - 具体的な改善提案（フェーズ3）
    - シンプル化と最適化提案
    - 依存関係の改善方法
    - 型定義の強化
    - 実装ガイダンスの提供
- **成果物**: 
  - 改善された `docs/data_models/integrated_model.md` - シンプル化された統合データモデル
  - `shared/index.ts` への完全な型定義実装 - 洗練された共通インターフェース
  - `server/src/models/` への最適化されたデータモデル実装 - 主要エンティティの完全なモデル定義
  - `server/src/tests/models/` への網羅的テスト実装 - 100%のテストカバレッジ確保

### 6. 環境変数収集 (★6env_assistant)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/50eb4d1e924c9139ef685c2f39766589
- **目的**: モックではなく実際の本番環境で使用する環境変数の設定
- **プロセス**:
  - プロジェクト要件の分析（ステップ1）
    - バックエンド環境設定、データベース接続設定、外部APIキー、フロントエンド環境変数、ログ設定などの特定
  - 質問リストの作成（ステップ2）
    - データベース、認証サービス、AIサービス、その他サードパーティサービスなどのカテゴリ別情報収集
  - 段階的な情報収集（ステップ3）
    - 基本設定、データベース設定、認証サービス、外部API、フロントエンド設定の詳細な収集
  - 環境変数ファイルの作成（ステップ4）
    - 収集した情報に基づいて構造化された.envファイルの作成
- **成果物**: 
  - `.env` - プロジェクトルートの環境変数ファイル（実際の本番用キーを含む、Gitに非コミット）
  - `docs/env.md` - 環境変数の説明と管理方法のドキュメント
  - 各環境（開発・ステージング・本番）向けの環境変数テンプレート

### 7. 認証システム構築 (★7auth_system_assistant)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/44b995b91e9879080c4e0169e7a51c0e
- **目的**: シンプルなJWT自社実装による認証システム構築
- **プロセス**:
  - ファイル調査と分析（ステップ1）
    - モックアップ、API仕様、データモデル、環境変数の分析
    - 認証システムの設計原則の確立
  - バックエンド実装（ステップ2-3）
    - JWTサービス実装（トークン生成・検証）
    - 認証コントローラー実装（ログイン・登録・リフレッシュ）
    - 認証ミドルウェア実装（トークン検証と権限チェック）
    - APIルート定義とバックエンドテスト
  - フロントエンド実装（ステップ4-5）
    - 認証サービス実装（トークン管理）
    - 認証コンテキスト実装（状態管理）
    - 認証UI実装（ログイン/登録フォーム）
    - 保護ルート実装とフロントエンドテスト
  - エンドツーエンドテストとセキュリティテスト（ステップ6-8）
    - 認証フローの総合テスト
    - 管理者アカウント作成スクリプト
    - セキュリティ脆弱性テスト
- **成果物**: 
  - `server/src/services/jwt.service.ts` - JWT認証サービス
  - `server/src/controllers/auth.controller.ts` - 認証コントローラー
  - `server/src/middleware/auth.middleware.ts` - 認証ミドルウェア
  - `client/src/contexts/AuthContext.tsx` - フロントエンド認証コンテキスト
  - `client/src/components/common/ProtectedRoute.tsx` - ルート保護コンポーネント
  - `docs/auth_architecture.md` - 認証システムアーキテクチャドキュメント
  - `server/scripts/createAdmin.ts` - 管理者アカウント作成スクリプト

### 8. デプロイ設定 (★8deploy_assistant)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/612fc1991ca477744c4544255d40fe0b
- **目的**: クラウドベースのWebアプリケーションデプロイ支援（特にGoogle Cloud Run）
- **プロセス**:
  - デプロイ前の準備（ステップ1）
    - 効率的なDockerfileの作成（マルチステージビルド）
    - 環境変数とシークレットの設定（Secret Manager）
    - ビルド時の最適化
  - バックエンドデプロイとモニタリング（ステップ2）
    - 最適なデプロイコマンドの設定
    - トラフィック管理の設定
    - デプロイ後の検証プロセス確立
  - フロントエンドデプロイ（ステップ3）
    - Firebase Hostingの設定
    - 継続的デプロイの設定（GitHub Actions）
  - デプロイエラーログの記録と管理（ステップ4）
    - `deploy-history.md`の作成と維持
    - エラーログの体系的分析
    - デプロイプロセスの継続的改善
- **成果物**: 
  - `Dockerfile` - マルチステージビルド用の最適化されたDockerfile
  - `server/deploy.sh` - デプロイスクリプト
  - `.github/workflows/deploy.yml` - GitHub Actions CI/CD設定
  - `deploy-history.md` - デプロイ履歴と問題解決記録
  - `docs/deploy.md` - 包括的なデプロイドキュメント
  - `firebase.json` - フロントエンドホスティング設定

### 9. GitHub管理 (★9gitmanager)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/e6167ac13d15f778c0cae369b0068813
- **目的**: GitHubへのコード安全なアップロード・管理支援
- **プロセス**:
  - リポジトリ初期設定（git init、.gitignore作成、初期コミット）
  - 作業保全チェック（未追跡ファイルの確認、部分コミットリスク警告）
  - 機密情報検出と対策（環境変数化、.gitignore確認）
  - 全体コミット手順（センシティブファイル以外の全ファイル追跡）
  - 安全なプッシュ準備（最終チェック、状態比較）
  - 定期的メンテナンス（リモート同期、ブランチ整理）
- **成果物**: 
  - `.gitignore` - センシティブファイル除外設定
  - `docs/gitrule.md` - Gitコミット規約とワークフロードキュメント
  - ブランチ戦略ドキュメント（main/develop/feature/bugfix/releaseブランチ構造）
  - コミット履歴保全と機密情報対策ガイドライン
  - 特殊状況対応手順（センシティブファイルの安全な削除方法）

### 10. 実装タスク分析 (★10implementation_task_analyzer)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/b168dcd63cc12e15c2e57bce02caf704
- **目的**: エンドポイントとUI連携の実装順序最適化と開発環境の統一化
- **プロセス**:
  - 全APIエンドポイントの抽出（API仕様書からエンドポイント特定）
  - データレイヤーによるグループ化（基盤、主要、派生、高次機能のレイヤー分け）
  - データ依存関係の分析（モデル間の関係性明確化）
  - UIコンポーネントとエンドポイントの対応分析（モックアップからコンポーネント抽出）
  - 外部サービス連携の分析（外部API依存関係特定）
  - ディレクトリ構造とコード分割の標準化（ドメイン/機能ベースの構造設計）
  - ファイルサイズと関数サイズの制限（保守性と可読性の向上）
- **成果物**: 
  - `docs/implementation_order.md` - 実装順序計画
    - 依存関係の全体図（データモデル、API、UIコンポーネント間の関係）
    - データレイヤー別エンドポイントグループ（4レイヤーでの分類）
    - 実装フェーズ計画（基盤から高次機能まで）
    - 優先順位と並行開発戦略（バックエンド/フロントエンド連携）
  - `docs/CURRENT_STATUS.md` - 現在の実装状況の包括的な更新
    - 詳細ディレクトリ構造と設計（ドメイン/機能ベース）
    - ファイル命名規則とコード編成ルール
    - コード分割の基本原則（ファイルサイズ上限500行、関数サイズ上限50行）
    - エンドポイントベースの進捗状況管理
    - 実装フェーズとタスクの完了率

### 11. スコープ実装 (★11scope_implementer)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/868ba99fc6e40d643a02e0e02c5e980a
- **目的**: 設計情報から高品質なコード生成と進捗管理
- **原則**:
  - 本番環境で通用する実装の追求（現実のAPIとの直接統合）
  - 統一データモデルとAPIパス管理の厳格なルール遵守
  - 垂直スライス方式による実装（サービス→コントローラ→ルート→UI）
  - ドメイン/機能ベースのコード構造の維持
- **プロセス**:
  - CURRENT_STATUS.mdでの実装優先順位の確認
  - APIエンドポイントの実装（バックエンド→フロントエンド統合）
  - 実装と並行したドキュメントとCURRENT_STATUS.mdの更新
  - コードレビューと自己検証によるQA
- **成果物**:
  - 高品質なコード実装（サービス、コントローラー、ルート、UI）
  - 更新されたCURRENT_STATUS.md（進捗状況）
  - ユニットテストとインテグレーションテスト

### 12. テスト管理と品質保証 (★12test_manager)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/247df2890160a2fa8f6cc0f895413aed
- **目的**: 実データに基づく効率的なテスト実装と品質保証の体系化
- **絶対原則の確立**:
  - TypeScriptエラーゼロポリシー（テスト開始前に必ずエラーゼロを確認）
  - インメモリモックデータの禁止（実際のデータベースのみ使用）
  - データベース理解の徹底（実データの構造と内容の完全把握）
- **プロセス**:
  - テスト戦略と計画の策定（テスト種類・範囲・優先順位・環境管理ガイドライン）
  - DB検証スクリプトの開発（データベース接続・構造確認と実データの型・関係性分析）
  - テスト結果の収集と分析（成功率・失敗パターン・カバレッジの追跡）
  - DB-TDDサイクルの確立（TS エラーチェック→DB状態確認→テスト設計→実装→再検証→ドキュメント化）

**重要な成果物**:
- **最初に作成** `docs/tests/strategy.md` - テスト戦略の中心ドキュメント（すべてのテスト作業の前に必ず参照）
- **最初に作成** `server/scripts/check-mongodb.js` - 基本的なデータベース検証スクリプト
- 必要に応じて追加のデータベース検証スクリプト

**テストファイル配置規則**:
```
server/
  └── src/
      └── tests/           # すべてのテストファイルのルートディレクトリ
          ├── models/      # モデルの単体テスト
          ├── api/         # APIエンドポイントのテスト
          ├── admin/       # 管理者APIテスト
          ├── integration/ # 統合テスト
          └── utils/       # テストユーティリティ
  └── scripts/             # データベース検証・テスト実行スクリプト
```

**重要**: すべてのテスト作業を開始する前に、必ず `docs/tests/strategy.md` を参照し、TypeScriptエラーチェックとデータベース確認を実施してください。テストファイルは必ず上記のディレクトリ構造に従って配置してください。


### 13. フロントエンドデバッグ専門家 (★13debug_detective)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/942ec5f5b316b3fb11e2fd2b597bfb09
- **目的**: フロントエンドエラーとAPI連携問題の体系的な分析と実用的な解決
- **原則**: 
  - 最初に必ずTypeScriptエラーをゼロにしてから調査を開始
  - プロジェクトの安定性を最優先した最小限の変更による問題解決
  - 各フェーズでユーザーの承認を得てから次に進む協働プロセス
- **プロセス**:
  - フェーズ0: エラーの初期分類（フロントエンド問題かバックエンド問題か判断）
  - フェーズ1: フロントエンドエラーの根本原因調査（データフロー追跡と分析）
  - フェーズ2: フロントエンドデータフロー検証とAPI連携分析
  - フェーズ3: フロントエンド解決策の設計（必要最小限の変更計画）
  - フェーズ4: 解決策の実装と検証（慎重な実装と副作用の確認）

**重要な診断アプローチ**:
- バックエンド問題と判断した場合は★12test_managerへの診断カルテを作成して引き継ぎ
- フロントエンド問題の場合はデータフローを徹底分析して最小変更で解決
- 潜在的なバグやパターンを特定し、短期修正と長期改善を明確に区別

**成果物**:
- 診断カルテ: バックエンド問題を★12test_managerに引き継ぐ際の詳細診断報告書
- フロントエンド解決策: 安全で実効性のある最小限の修正計画
- 根本原因分析レポート: 問題の発生源とパターンを明らかにする分析ドキュメント

### 14. 追加機能実装アシスタント (★14feature_implementation_assistant)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/8c09f971e4a3d020497eec099a53e0a6
- **目的**: 機能追加・変更・削除要望を分析し、最適な実装プロセスを決定すること
- **原則**: 
  - プロジェクト全体の整合性を常に最優先
  - 要望の本質を理解し、真に必要な機能に絞り込む
  - 変更の影響範囲を正確に評価し、適切なプロセスを選択
- **プロセス**:
  - フェーズ1: 要望の理解と本質抽出（機能の目的と要件の明確化）
  - フェーズ2: 影響範囲分析と規模判断（小・中・大規模の判定）
  - フェーズ3: 実装プロセスの決定と準備（最適なルートの選択）

**変更規模に応じた判断**:
- 小規模変更: CURRENT_STATUS.mdとimplementation_order.md更新→★11へ引き継ぎ
- 中規模変更: 簡易要件定義作成→★3モックアップ作成へ引き継ぎ
- 大規模変更: 要件概要作成→★1要件定義へ引き継ぎ
- 機能削除: 削除計画作成→★15リファクタリング専門家へ引き継ぎ

**成果物**:
- 変更規模判断レポート: 機能要望の影響範囲と規模の分析
- 引き継ぎドキュメント: 適切なAIアシスタントへの詳細な引き継ぎ資料
- ドキュメント更新: CURRENT_STATUS.mdと実装順序計画の更新

### 15. リファクタリング専門家 (★15refactoring_expert)
http://appgenius-portal-test-235426778039.asia-northeast1.run.app/api/prompts/public/af9d922c29beffe1224ac6236d083946
- **目的**: コードの技術的負債を特定し、表面的な修正ではなく根本的な設計改善を提案すること
- **原則**: 
  - 「何を残すか」ではなく「何を削除すべきか」という視点で考える
  - 表面的な対症療法ではなく、根本原因に対処する
  - コードの全体像と歴史的背景を徹底的に調査する
  - 短期的な便宜より長期的な保守性を常に優先する
  - 大胆な決断と明確な方向性を示す
- **プロセス**:
  - フェーズ1: コードの全体像と歴史調査（情報収集フェーズ）
  - フェーズ2: 技術的負債と設計問題の特定（診断フェーズ）
  - フェーズ3: リファクタリング戦略の決定（戦略フェーズ）
  - フェーズ4: 詳細なリファクタリング計画の作成（計画フェーズ）
  - フェーズ5: リファクタリング提案の提示と検証（提案フェーズ）

**「作り直すべきか」の決断ポイント**:
- 構造的硬直性: 簡単な変更に多大な労力が必要
- 過度な複雑性: 理解や修正が極めて困難
- 非モジュール性: 独立したテストや変更が困難
- パッチワーク的な修正の蓄積
- 将来の拡張が現在の設計では不可能

**成果物**:
- 技術的負債の分析レポート: 問題のカテゴリと優先度のリスト
- リファクタリング戦略提案: 段階的改善・部分的再設計・完全再実装などの戦略選択
- 詳細なリファクタリング計画書: 具体的な実施ステップとタイムライン
- リファクタリング提案レポート: 根拠、期待効果、リスク分析を含む総合提案


## AIアシスタントが作成する資料ディレクトリ構造

Appgeniusでは各AIアシスタントが担当するフェーズに応じて、以下のような資料が整理されます。この構造により、プロジェクト全体の一貫性と追跡可能性が確保されます：

```
docs/
├── requirements.md                # ★1: 要件定義書
├── CURRENT_STATUS.md              # ★2/★10: プロジェクト全体構造と実装状況
├── deploy.md                      # ★2/★8: インフラとデプロイ戦略
├── auth_architecture.md           # ★7: 認証システムアーキテクチャ
├── implementation_order.md        # ★10: 実装順序計画
├── gitrule.md                     # ★9: Gitコミット規約とワークフロー
├── env.md                         # ★6: 環境変数の説明と管理方法
├── tests/                         # ★12: テスト関連ドキュメント
│   └── strategy.md                # ★12: テスト戦略の中心ドキュメント
├── refactoring/                   # ★15: リファクタリング関連ドキュメント
│   ├── technical_debt.md          # ★15: 技術的負債分析レポート
│   └── strategies.md              # ★15: リファクタリング戦略ガイドライン
│
├── api/                           # ★3: API仕様書（カテゴリ別）
│   ├── index.md                   # API共通情報
│   ├── auth.md                    # 認証API仕様
│   ├── users.md                   # ユーザー管理API仕様
│   └── [カテゴリ名].md            # その他機能カテゴリAPI仕様
│
├── data_models/                   # ★3/★4/★5: データモデル関連
│   ├── [ページ名].md              # ★3: ページごとのデータモデル分析
│   ├── integrated_model.md        # ★4/★5: 統合データモデル
│   └── erd.md                     # ★4: エンティティ関係図
│
├── ui/                            # ★3: UI設計ドキュメント
│   └── [ページ名].md              # ページごとのUI設計と状態管理
│
└── implementation/                # ★3: 実装ガイド
    └── [ページ名].md              # ページごとの実装ガイド

shared/
└── index.ts                       # ★2/★4/★5: 共有型定義・APIパス定義

mockups/
└── [ページ名].html                # ★3: ページごとのモックアップ

.env                               # ★6: 環境変数ファイル（非公開）

server/
├── src/
│   ├── services/
│   │   └── jwt.service.ts         # ★7: JWT認証サービス
│   ├── controllers/
│   │   └── auth.controller.ts     # ★7: 認証コントローラー
│   ├── middleware/
│   │   └── auth.middleware.ts     # ★7: 認証ミドルウェア
│   ├── models/                    # ★5: 最適化されたデータモデル
│   └── tests/                     # ★12: テストファイルのルートディレクトリ
│       ├── models/                # ★12: モデルの単体テスト
│       ├── api/                   # ★12: APIエンドポイントのテスト
│       ├── admin/                 # ★12: 管理者APIテスト
│       ├── integration/           # ★12: 統合テスト
│       └── utils/                 # ★12: テストユーティリティ
├── deploy.sh                      # ★8: デプロイスクリプト
└── scripts/                       
    ├── createAdmin.ts             # ★7: 管理者アカウント作成スクリプト
    ├── check-mongodb.js           # ★12: 基本的なデータベース検証スクリプト
    ├── test-diagnostics/          # ★13: フロントエンドデバッグ診断用スクリプト
    └── refactoring/               # ★15: リファクタリング関連スクリプト
        ├── analyze-complexity.js  # ★15: コード複雑性分析スクリプト
        └── dependency-graph.js    # ★15: 依存関係可視化スクリプト

client/
├── src/
│   ├── contexts/
│   │   └── AuthContext.tsx        # ★7: フロントエンド認証コンテキスト
│   └── components/
│       └── common/
│           └── ProtectedRoute.tsx # ★7: ルート保護コンポーネント
└── .firebaserc                    # ★8: Firebaseホスティング設定

.gitignore                         # ★9: センシティブファイル除外設定
.github/
└── workflows/
    └── deploy.yml                 # ★8: GitHub Actions CI/CD設定
deploy-history.md                  # ★8: デプロイ履歴と問題解決記録
```

## 重要な中央資料

プロジェクト開発の効率化のため、以下の中央資料を常に最新に保ち、これらを参照点として開発を進めます：

1. **要件定義**: `docs/requirements.md`
   - プロジェクトの目的、機能要件、非機能要件を定義
   - すべての開発判断の基盤となる文書

2. **モックアップ**: `mockups/*.html`
   - 視覚的な実装目標を提供
   - フロントエンド実装の基準点

3. **API仕様書**: `docs/api/*.md`
   - 機能カテゴリ別に整理されたAPIエンドポイント仕様
   - リクエスト/レスポンス型定義とサンプル

4. **開発方針**: `CLAUDE.MD`
   - 開発姿勢と倫理
   - 実装上の制約条件
   - 品質保証のためのガイドライン

5. **システムアーキテクチャとデプロイ戦略**: `docs/deploy.md`
   - 技術スタック選定の根拠
   - インフラストラクチャの設計
   - 環境構築からデプロイまでの詳細手順

6. **実装順序計画**: `docs/implementation_order.md`
   - データレイヤー別エンドポイントグループ
   - 実装フェーズ計画
   - バックエンドとフロントエンドの並行開発戦略

7. **現状と構造**: `docs/CURRENT_STATUS.md`
   - 現在の実装状況
   - ディレクトリ構造
   - 進捗率

8. **共有定義**: `shared/index.ts`
   - APIパス定義
   - データモデルの型定義
   - フロントエンド・バックエンド間の共通インターフェース

9. **データモデル**: 
   - `docs/data_models/integrated_model.md` - 統合データモデル
   - `docs/data_models/erd.md` - エンティティ関係図
   - `shared/index.ts` - 型定義の実装
   - `server/src/models/` - データモデル実装

10. **テスト戦略と構成**: 
   - `docs/tests/strategy.md` - テスト戦略の中心ドキュメント
   - `server/scripts/check-mongodb.js` - データベース検証スクリプト
   - `server/src/tests/` - テストファイルの標準配置ディレクトリ

11. **リファクタリング戦略**: 
   - `docs/refactoring/technical_debt.md` - 技術的負債分析レポート
   - `docs/refactoring/strategies.md` - リファクタリング戦略ガイドライン
   - `server/scripts/refactoring/` - リファクタリング関連分析スクリプト

## 開発フロー

Aoogeniueプロジェクトでは、以下のような反復的なフローで開発を進めます：

1. **要件定義フェーズ**
   - 非技術者の要望を要件定義書に変換（★1）
   - 既存プロジェクトの場合は、コードベースを分析して要件を抽出（★1）

2. **システム基盤構築フェーズ**
   - システムアーキテクチャ設計（★2）
     - 技術スタック選定
     - ディレクトリ構造設計
     - インフラストラクチャとデプロイ戦略
   - 環境変数設定（★6）
   - 認証システム構築（★7）

3. **モックアップと仕様策定フェーズ**
   - 機能ごとにHTML/CSS/JSモックアップを作成（★3）
   - モックアップからAPIエンドポイント仕様を生成（★3）
   - API仕様書の機能カテゴリ別整理（★3）

4. **データモデルとAPI設計フェーズ**
   - ページごとのデータモデル分析（★3）
   - データモデルの統合と最適化（★4）
   - 統合モデルの精査と実装（★5）
   - データモデルのテストカバレッジ確保（★5）

5. **実装フェーズ**
   - ビジネスロジックの依存関係分析（★10）
   - モックアップとAPI仕様書を基にバックエンド実装（★11/★12）
   - モックアップを基にフロントエンド実装（★11/★12）
   - ユニットテストと結合テスト（★12）

6. **デバッグと改善フェーズ**
   - エラーの根本原因分析（★13）
   - バグ修正と最適化（★13）
   - フロントエンド-バックエンド統合テスト

7. **デプロイと検証フェーズ**
   - ステージング環境へのデプロイ（★8）
   - リリースノート作成（★9）
   - GitHub経由のCI/CD実行（★9）

## 機能変更・追加プロセス

プロジェクトの進行中に新機能追加や変更要望が発生した場合、以下のプロセスに従って開発サイクルに統合します：

### 変更規模に応じた合流ポイント

1. **小規模な機能追加/変更**（既存機能の微調整、単一エンドポイントの追加など）:
   - 開始ポイント: ★10 実装優先順位（implementation_order.md）の更新
   - プロセス:
     1. CURRENT_STATUS.mdに追加機能・変更内容を記録
     2. 既存のモックアップやデータモデルとの整合性確認
     3. 実装優先順位に追加
     4. ★11 スコープ実装へ直接進む

2. **中規模の機能追加/変更**（既存機能の拡張、複数画面の変更など）:
   - 開始ポイント: ★3 モックアップ作成
   - プロセス:
     1. 簡易版の要件定義追加
     2. 対象画面のモックアップ作成/更新
     3. データモデルへの影響分析（★4データモデル統合で確認）
     4. APIエンドポイント定義の更新
     5. 実装順序計画の更新
     6. ★11 スコープ実装へ進む

3. **大規模な機能追加**（新しい機能領域、コアシステムへの影響大）:
   - 開始ポイント: ★1 要件定義の更新
   - プロセス:
     1. 要件定義書への追加
     2. システムアーキテクチャへの影響確認
     3. ★3～★5 のプロセスを完全に踏襲
     4. 新しい実装順序計画の作成
     5. 標準開発サイクルに統合

### 機能削除/廃止プロセス

機能の削除または廃止を行う場合のプロセス：

1. **影響分析**:
   - 依存している他の機能の特定
   - データモデルへの影響分析
   - フロントエンド・バックエンド両方での影響範囲確認

2. **削除計画**:
   - ★15 リファクタリング専門家による分析
   - 段階的な削除計画の作成
   - 互換性維持のための移行計画（必要な場合）

3. **ドキュメント更新**:
   - CURRENT_STATUS.mdの更新
   - APIドキュメントからの削除（廃止予定マークを付ける）
   - データモデルドキュメントの更新

4. **実装**:
   - コードの削除
   - テストの更新
   - デプロイと検証

## リファクタリング完了管理

リファクタリングの計画・実行・完了を体系的に管理するためのプロセス：

### リファクタリング記録

リファクタリングの記録は以下の方法で管理します：

1. **CURRENT_STATUS.mdでの管理**:
   - 「リファクタリング」セクションを設ける
   - 以下のカテゴリに分類:
     - **完了したリファクタリング**: 日付、内容、影響範囲、技術的改善点
     - **進行中のリファクタリング**: 担当者、進捗状況、完了予定日
     - **予定されているリファクタリング**: 優先度、見積り時間、技術的負債の種類

2. **大規模リファクタリングの詳細記録**:
   - `docs/refactoring/` ディレクトリに個別のドキュメント作成
   - `deploy-history.md` にもデプロイとの関連を記録

3. **コード内のコメント**:
   - リファクタリングによる変更には適切なコメントを残す
   - 大きな設計変更には関連するドキュメントへの参照を含める

### リファクタリングの評価

リファクタリング完了後の評価指標：

1. **技術的指標**:
   - コードの複雑性低減（循環的複雑度の変化）
   - ファイルサイズと関数サイズの改善
   - 依存関係の簡素化
   - テストカバレッジの向上

2. **開発効率指標**:
   - 同様の変更にかかる時間の比較
   - バグ発生率の変化
   - レビュープロセスの効率化

3. **ユーザー体験指標**（該当する場合）:
   - パフォーマンスの向上
   - 応答時間の改善
   - エラー発生率の低減

## 開発原則

1. **モックアップ主導開発**
   - モックアップをまず作成し、それを「動かす」ことに集中
   - 非技術者にも理解しやすい進捗状況の可視化

2. **個別エンドポイント管理**
   - APIルートは機能カテゴリごとに個別ファイルで管理
   - 保守性と拡張性の向上

3. **中央資料の一貫性維持**
   - すべての変更は中央資料に反映
   - 複数AIが同じ情報源を参照できるよう整合性を保持

4. **シンプルさと品質重視の姿勢**
   - 「とりあえず動く」ではなく、正しく簡潔な実装を追求
   - 本質的に必要なものだけを残し、複雑性を排除
   - 問題の根本原因を特定し、正面から解決

5. **実証的アプローチ**
   - モックデータではなく実際の環境変数を使用
   - テスト環境でも本番環境と同じ認証情報を使用

6. **シンプルな自社実装認証**
   - JWTベースの独自認証システム実装
   - データフローのシンプル化とエラー特定の容易さを実現
   - アクセストークンとリフレッシュトークンの2段階方式

7. **機能のライフサイクル管理**
   - 機能の提案から実装、保守、廃止までを体系的に管理
   - 変更・追加・削除の影響範囲を常に評価
   - リファクタリングを継続的改善サイクルに組み込む

## まとめ

DailyFortuneプロジェクトの開発方法論は、要件定義からモックアップ作成、データモデル設計、実装、テスト、デプロイまでの一連のプロセスを体系化し、複数AIの専門性を活かした開発アプローチです。中央資料の一貫性維持とモックアップ主導の開発により、視覚的で理解しやすい進捗管理を実現しています。

この方法論の特徴は、シンプルさを追求する設計思想、ページごとのデータモデルを統合した一貫性のあるデータ構造、APIドキュメントの機能カテゴリ別管理、シンプルなJWT自社実装による認証システム、そして実際の環境変数と連携したテストによる品質保証にあります。さらに、機能追加・変更プロセスやリファクタリング管理を統合することで、プロジェクトの継続的な進化と保守を体系的に支援します。AIチームの各メンバーが自分の専門分野に集中し、一貫した成果物を生み出すことで、シンプルで堅牢、かつ保守性の高い開発を実現します。
