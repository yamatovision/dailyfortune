# 四柱推命における用神（運気を高める要素）を求めるアルゴリズム

## 1. 用神（Yojin）とは

四柱推命において「用神」（ようじん）とは、個人の運気を高めるために必要な「五行」の要素です。用神は日干（Day Master）を中心とした命式の分析を通じて決定され、人生における方針や決断のガイドラインとなります。本文書では、用神を特定するアルゴリズムの詳細を記述します。

## 2. 用神の基本概念

用神とは、命式の中で最も重要な役割を果たす五行（木・火・土・金・水）であり、その人の運気を整えるために必要な要素です。用神は以下の役割を持ちます：

1. 命式のバランスを整える
2. 弱点を補い、過剰な要素を抑制する 
3. 日干（命式の中心）を適切に調整する
4. 運気の流れを良い方向に導く

## 3. 用神と関連概念

四柱推命では、用神に加えて、喜神・忌神・仇神の3つの神が存在します：

1. **用神（ようじん）**: 命式のバランスを整えるために必要な五行
2. **喜神（きじん）**: 用神を助け、良い運気をもたらす五行
3. **忌神（きじん）**: 用神を妨げる、避けるべき五行
4. **仇神（きゅうじん）**: 命式に悪影響を与える五行

これらの関係性は五行の相生・相剋の法則に基づいています：
- 相生（生じる関係）：木→火→土→金→水→木
- 相剋（克する関係）：木→土→水→火→金→木

## 4. 用神を求めるステップ

### 4.0 全体の流れ

用神を求める手順の概要は以下の通りです：

1. **格局判定**:
   - まず命式が「特別格局」か「普通格局」かを判定します
   - 特別格局の場合は、直接「特別格局の用神早見表」から用神を決定します（他のステップは不要）
   - 普通格局の場合は、身強・身弱の判定と通変星集計を行い、「普通格局の用神早見表」を参照します

2. **特別格局の場合**:
   - 「従旺格」「従強格」「従児格」「従財格」「従殺格」「従勢格」のいずれかと判定された場合
   - 直接早見表を参照し、用神を決定（通変星の出現頻度は考慮しない）
   - 例：「従財格」の場合は用神が「財」と即決定

3. **普通格局の場合**:
   - 身強・身弱を判定
   - 通変星を集計して多い通変星を特定
   - 格局タイプ、身強/身弱、多い通変星の組み合わせから用神を決定

### 4.1 身強・身弱を判定する

用神を求める前に、まず命式が「身強」か「身弱」かを判定する必要があります。以下の6つの条件を確認します。

#### 身強・身弱の判定条件

1. **条件A: 得令（当旺・次旺）にあてはまる**
   - 日干の五行が月支において当旺または次旺の状態にあるか確認
   - 例：甲木(日干)の場合、寅・卯月(当旺)、子・亥月(次旺)で強まる
   
   | 日干の五行 | 当旺の月支 | 次旺の月支 |
   |------------|------------|------------|
   | 甲・乙（木）| 寅・卯    | 子・亥    |
   | 丙・丁（火）| 巳・午    | 寅・卯    |
   | 戊・己（土）| 辰・未・戌・丑 | 巳・午 |
   | 庚・辛（金）| 申・酉    | 辰・未・戌・丑 |
   | 壬・癸（水）| 子・亥    | 申・酉    |

2. **条件B: 地支が日干を強めている**
   - 年支・月支・日支・時支のうち、日干を強める地支がいくつあるか確認
   
   | 日干 | 日干を強める地支 |
   |------|------------------|
   | 甲・乙 | 寅・卯・子・亥 |
   | 丙・丁 | 巳・午・寅・卯 |
   | 戊・己 | 辰・戌・未・丑、巳・午 |
   | 庚・辛 | 申・酉、辰・戌・未・丑 |
   | 壬・癸 | 子・亥、申・酉 |

3. **条件C: 天干が日干を強めている**
   - 年干・月干・時干のうち、日干を強める天干がいくつあるか確認
   
   | 日干 | 日干を強める天干 |
   |------|------------------|
   | 甲 | 甲・乙・壬・癸 |
   | 乙 | 乙・甲・壬・癸 |
   | 丙 | 丙・丁・甲・乙 |
   | 丁 | 丁・丙・甲・乙 |
   | 戊 | 戊・己・丙・丁 |
   | 己 | 己・戊・丙・丁 |
   | 庚 | 庚・辛・戊・己 |
   | 辛 | 辛・庚・戊・己 |
   | 壬 | 壬・癸・庚・辛 |
   | 癸 | 癸・壬・庚・辛 |

4. **条件D: 地支に日干の五行を強める三方会局がある**
   - 例：木の三方会局(寅・卯・辰)は木の日干を強める
   
   | 三方会局 | 五行 | 強める日干 |
   |---------|------|-----------|
   | 寅・卯・辰 | 木 | 甲・乙 |
   | 巳・午・未 | 火 | 丙・丁 |
   | 申・酉・戌 | 金 | 庚・辛 |
   | 亥・子・丑 | 水 | 壬・癸 |

5. **条件E: 地支に日干の五行を強める三合会局がある**
   - 例：木の三合会局(亥・卯・未)は木の日干を強める
   
   | 三合会局 | 五行 | 強める日干 |
   |---------|------|-----------|
   | 亥・卯・未 | 木 | 甲・乙 |
   | 寅・午・戌 | 火 | 丙・丁 |
   | 巳・酉・丑 | 金 | 庚・辛 |
   | 申・子・辰 | 水 | 壬・癸 |

6. **条件F: 日干が「戊」か「己」で、地支に四墓土局が形成されている**
   - 四墓土局：辰・戌・丑・未の地支が地支位置にそろっている
   - 土の気が強まる命式

#### 身強・身弱の最終判定

**身強判定①**:
- 条件A〜Cのうち、条件Aを含めて2つ以上該当すれば身強

**身強判定②**:
- 条件D・Eのどちらか1つでも、月支を含んでそろっていれば身強

**身強判定③**:
- 月支を含まない場合は、他に条件Cが1つ以上該当すれば身強

**身強判定④**:
- 条件Fに該当すれば身強

**身弱判定**:
- 身強判定①〜④のいずれにも該当しなければ身弱

### 4.2 通変星（十神関係）を集計する

命式（年・月・日・時の天干と地支の蔵干）から通変星（十神関係）を集計します。通変星は以下の5つのグループに分類して集計します：

1. **比劫** = 比肩・劫財（日干と同じ五行）
2. **印** = 偏印・正印（日干を生じる五行）
3. **食傷** = 食神・傷官（日干が生じる五行）
4. **財** = 偏財・正財（日干が克する五行）
5. **官殺** = 偏官・正官（日干を克する五行）

通変星の集計では以下の点に注意します：
- 天干の十神関係をカウント
- 地支の蔵干（本気）の十神関係をカウント
- 中気・余気はカウントしない

### 4.3 用神・喜神・忌神・仇神を求める統一プロセス

用神および関連する神（喜神・忌神・仇神）は、すべて共通のシンプルなプロセスで決定します。この統一プロセスにより、四柱推命の命式から各要素を一貫性を持って導き出すことができます。

#### 4.3.1 統一決定プロセス

すべての神（用神・喜神・忌神・仇神）は以下の共通ステップで決定します：

1. **早見表から通変星ペアを取得**
   - 特別格局の場合：直接「特別格局早見表」から各神の通変星ペアを取得
   - 普通格局の場合：格局タイプ、身強/身弱、命式内で最も多い通変星の3つの要素に基づいて対応する早見表から通変星ペアを取得

2. **通変星ペアから具体的な十神を選定**
   - 取得した通変星ペア（比劫・印・食傷・財・官殺）内の個別十神の出現頻度を計算
   - **重要**: 天干と地支の蔵干の「本気」のみを対象として集計
   - 最も出現頻度が高い十神を選定
   - 例：「財」が通変星ペアなら、偏財と正財の出現数を比較し多い方を選択

3. **同数の場合の処理ルール**
   - 同じペア内で出現数が同じ場合：
     * 天干よりも地支の通変星を優先
     * 地支の中でも月支を含むものを特に重視
   - それでも決まらない場合：
     * 伝統的なデフォルト値を使用（通常は「正」系を優先）

4. **五行属性と説明文の生成**
   - 選定された十神から対応する五行属性を特定
   - 目的に応じた説明文を生成

#### 4.3.2 具体例：実際の計算

例として、格局が「従財格」（特別格局）の場合：

1. **通変星ペアの取得**
   - 特別格局早見表から用神は「財」と決定
   - 同じく喜神は「食傷」、忌神は「比劫」、仇神は「印」と決定

2. **命式内の通変星を数える**（仮定の例）
   - 財ペア内：偏財[2]個、正財[0]個
   - 食傷ペア内：食神[1]個、傷官[1]個
   - 比劫ペア内：比肩[1]個、劫財[0]個
   - 印ペア内：偏印[0]個、正印[1]個

3. **具体的な神の決定**
   - 用神「財」→ 偏財[2]個 > 正財[0]個 → 「偏財」
   - 喜神「食傷」→ 食神[1]個 = 傷官[1]個 → 地支優先ルールで「食神」
   - 忌神「比劫」→ 比肩[1]個 > 劫財[0]個 → 「比肩」
   - 仇神「印」→ 偏印[0]個 < 正印[1]個 → 「正印」

このようにすべての神について同じプロセスを適用することで、一貫性のある結果を得ることができます。また、同じ命式から複数の神を効率的に計算することが可能になります。

## 5. 格局タイプ別の用神早見表

### 5.1 特別格局の用神・喜神・忌神・仇神早見表

| 格局タイプ | 用神 | 喜神 | 忌神 | 仇神 |
|-----------|------|------|------|------|
| 従旺格 | 比劫 | 印 | 官殺 | 財 |
| 従強格 | 印 | 比劫 | 財 | 食傷 |
| 従児格 | 食傷 | 財 | 印 | 比劫 |
| 従財格 | 財 | 食傷 | 比劫 | 印 |
| 従殺格 | 官殺 | 財 | 印 | 比劫 |
| 従勢格 | 財 | 官殺・食傷 | 比劫 | 印 |

### 5.2 普通格局の用神・喜神・忌神・仇神早見表

### 建禄格・月刃格の早見表

| 身強弱 | 多い通変星 | 用神 | 喜神 | 忌神 | 仇神 |
|-------|-----------|------|------|------|------|
| 身強  | 比劫      | 官殺 | 財   | 比劫 | 印   |
| 身強  | 印        | 財   | 食傷 | 比劫 | 印   |
| 身強  | 食傷      | 財   | 官殺 | 比劫 | 印   |
| 身強  | 財        | 官殺 | 財   | 印   | 比劫 |
| 身強  | 官殺      | 食傷 | 財   | 印   | 比劫 |
| 身弱  | 官殺      | 印   | 比劫 | 財   | 食傷 |
| 身弱  | 財        | 比劫 | 印   | 官殺 | 財   |
| 身弱  | 食傷      | 印   | 比劫 | 財   | 食傷 |

### 食神格・傷官格の早見表

| 身強弱 | 多い通変星 | 用神 | 喜神 | 忌神 | 仇神 |
|-------|-----------|------|------|------|------|
| 身強  | 比劫      | 食傷 | 財   | 印   | 比劫 |
| 身強  | 印        | 財   | 食傷 | 比劫 | 印   |
| 身強  | 食傷      | 財   | 官殺 | 比劫 | 印   |
| 身強  | 財        | 官殺 | 財   | 印   | 比劫 |
| 身強  | 官殺      | 食傷 | 財   | 印   | 比劫 |
| 身弱  | 官殺      | 印   | 比劫 | 財   | 食傷 |
| 身弱  | 財        | 比劫 | 印   | 官殺 | 財   |
| 身弱  | 食傷      | 印   | 比劫 | 財   | 食傷 |

### 偏財格・正財格の早見表

| 身強弱 | 多い通変星 | 用神 | 喜神 | 忌神 | 仇神 |
|-------|-----------|------|------|------|------|
| 身強  | 比劫      | 食傷 | 財   | 印   | 比劫 |
| 身強  | 印        | 財   | 食傷 | 比劫 | 印   |
| 身強  | 食傷      | 財   | 官殺 | 比劫 | 印   |
| 身強  | 財        | 官殺 | 財   | 印   | 比劫 |
| 身強  | 官殺      | 食傷 | 財   | 印   | 比劫 |
| 身弱  | 官殺      | 印   | 比劫 | 財   | 食傷 |
| 身弱  | 財        | 比劫 | 印   | 官殺 | 財   |
| 身弱  | 食傷      | 印   | 比劫 | 財   | 食傷 |



## 正官格・偏官格の用神・喜神・忌神・仇神早見表

| 身強/身弱 | 多い通変星 | 用神 | 喜神 | 忌神 | 仇神 |
|-----------|-----------|------|------|------|------|
| 身弱 | 食傷 | 印 | 比劫 | 財 | 食傷 |
| 身弱 | 財 | 比劫 | 印 | 官殺 | 財 |
| 身弱 | 官殺 | 印 | 比劫 | 財 | 食傷 |
| 身強 | 官殺 | 食傷 | 財 | 印 | 比劫 |
| 身強 | 財 | 官殺 | 財 | 印 | 比劫 |
| 身強 | 食傷 | 財 | 官殺 | 比劫 | 印 |
| 身強 | 印 | 財 | 食傷 | 比劫 | 印 |
| 身強 | 比劫 | 官殺 | 財 | 比劫 | 印 |

## 印緑格・偏印格の用神・喜神・忌神・仇神早見表

| 身強/身弱 | 多い通変星 | 用神 | 喜神 | 忌神 | 仇神 |
|-----------|-----------|------|------|------|------|
| 身弱 | 食傷 | 印 | 比劫 | 財 | 食傷 |
| 身弱 | 財 | 比劫 | 印 | 官殺 | 財 |
| 身弱 | 官殺 | 印 | 比劫 | 財 | 食傷 |
| 身強 | 官殺 | 食傷 | 財 | 印 | 比劫 |
| 身強 | 財 | 官殺 | 財 | 印 | 比劫 |
| 身強 | 食傷 | 財 | 官殺 | 比劫 | 印 |
| 身強 | 印 | 財 | 食傷 | 比劫 | 印 |
| 身強 | 比劫 | 官殺 | 財 | 比劫 | 印 |


### 5.3 通変星の対応関係

通変星の略称は以下のように対応しています：

- **比劫** = 比肩（同じ五行・同じ陰陽）＋劫財（同じ五行・異なる陰陽）
- **印** = 偏印（生じる五行・同じ陰陽）＋正印（生じる五行・異なる陰陽）
- **食傷** = 食神（生じさせる五行・同じ陰陽）＋傷官（生じさせる五行・異なる陰陽）
- **財** = 偏財（克する五行・同じ陰陽）＋正財（克する五行・異なる陰陽）
- **官殺** = 偏官（克される五行・同じ陰陽）＋正官（克される五行・異なる陰陽）

## 6. 実際の計算例

### 例：1985年5月8日06時31分生まれの場合

#### 1. 命式の取得
- 年柱：乙丑（蔵干：己土・辛金・癸水）
- 月柱：辛巳（蔵干：丙火・庚金・戊土）
- 日柱：丁未（蔵干：己土・丁火・乙木）
- 時柱：癸卯（蔵干：乙木）
- 日干：丁（火）

#### 2. 通変星の計算と集計
- 比肩：1（丁火と同じ火の五行・同じ陰陽）
- 劫財：1（丙火は同じ火の五行・陽陰が異なる）
- 食神：1（戊土は火が生じる土の五行・陽）
- 傷官：2（己土は火が生じる土の五行・陰）
- 偏財：1（庚金は火が克する金の五行・陽）
- 正財：2（辛金は火が克する金の五行・陰）
- 偏官：0（該当なし）
- 正官：2（癸水は火を克する水の五行・陰）
- 偏印：0（該当なし）
- 印緑：3（乙木は火を生じる木の五行・陰）

通変星ペアの集計：
- 比劫（比肩+劫財）：2
- 印（偏印+正印）：3
- 食傷（食神+傷官）：3
- 財（偏財+正財）：3
- 官殺（偏官+正官）：2

#### 3. 身強・身弱の判定
- 条件A：得令 - 丁火は巳月に強まる（該当）
- 条件B：巳支・未支が日干を強める（該当）
- 条件C：丙天干が日干を強める（該当）
- 身強判定①：条件A、B、Cに該当するため身強と判定

#### 4. 格局の判定
- 月刃格と判定（丁日干の月刃格は巳月支）

#### 5. 用神の特定
身強の月刃格で、印（乙木=印緑）が多い通変星の場合：
- 早見表から用神は「財」

#### 6. 具体的な用神の決定
- 「財」には「偏財」と「正財」があり、命式内では「正財」が多い（2 vs 1）
- 具体的な用神は「正財」（辛金）と決定

## 7. 用神の活用法

用神が特定できたら、以下のように活用できます：

1. **五行バランスの調整**:
   - 身強の場合：日干を抑制するための用神を増やす
   - 身弱の場合：日干を強めるための用神を増やす

2. **季節による運気の変化**:
   - 用神の五行が旺盛な季節は運気が高まる
   - 木：春（2-4月）
   - 火：夏（5-7月）
   - 土：季節の変わり目
   - 金：秋（8-10月）
   - 水：冬（11-1月）

3. **日常生活への応用**:
   - 用神に関連する色や方角を取り入れる
   - 用神の五行に関連する職業や活動を選ぶ
   - 喜神を取り入れ、忌神・仇神を避ける

## 8. 実装上の考慮事項

### 8.1 蔵干の重み付け

蔵干（地支に隠れた天干）は、その重要度に応じて以下のように分類されます：
- **本気**（主要蔵干）：最も影響力が強い蔵干（重み 1.0）
- **中気**（第二蔵干）：二番目に影響力がある蔵干（重み 0.7）
- **余気**（第三蔵干）：三番目に影響力がある蔵干（重み 0.4）

用神を求める際には、蔵干の「本気」のみを考慮し、「中気」と「余気」は集計に含めません。

### 8.2 テーブル駆動設計

用神判定の実装には、テーブル駆動設計が効果的です。格局タイプ、身強/身弱、多い通変星の3つの要素をキーとして、用神・喜神・忌神・仇神を取得するルックアップテーブルを構築します。

```typescript
// 早見表データ（一部抜粋）
const yojinLookupTable = {
  'kenroku_getsujin': {
    'strong': {
      'hikoh': { yojin: '官殺', kijin: '財', kijin: '比劫', kyujin: '印' },
      'in': { yojin: '財', kijin: '食傷', kijin: '比劫', kyujin: '印' },
      // ...
    },
    'weak': {
      // ...
    }
  },
  // 他の格局タイプも同様に...
};
```

### 8.3 用神判定のフロー

1. 四柱推命の計算から格局を判定
   - 身強/身弱を判定
   - 格局タイプを特定
   - 多い通変星を特定

2. 早見表に基づいて用神を特定
   - 格局タイプ、身強/身弱、多い通変星の3条件で判定
   - 通変星ペアから具体的な通変星を特定

3. 用神に基づいた運勢アドバイスを生成
   - 用神と喜神を活用した提案
   - 忌神と仇神を避ける提案

## 9. 結論

用神計算アルゴリズムは、身強・身弱判定と格局判定に基づいて、個人に最適な五行要素を特定するプロセスです。このアルゴリズムを実装することで、四柱推命プロフィールに基づいた具体的なアドバイスを提供し、ユーザーの生活や決断をサポートすることができます。

用神は単なる運勢予測ではなく、個人の命式のバランスを取るためのガイドとなり、最適な選択肢を見つける手助けとなります。これにより、DailyFortuneアプリケーションの提供する四柱推命情報の価値と実用性を大幅に高めることができます。