# API設計ドキュメント

このディレクトリには、DailyFortuneアプリケーションのAPIエンドポイントの設計と使用方法を説明するドキュメントが含まれています。

## APIの概要

DailyFortuneのAPIは以下のカテゴリに分類されます：

1. **認証API** - [auth.md](./auth.md)
   - ログイン、登録、プロフィール取得などの認証関連機能

2. **ユーザー管理API** - [users.md](./users.md)
   - ユーザー情報の取得、更新、四柱推命プロフィール管理など

3. **チーム関連API** - [teams.md](./teams.md)
   - チーム作成、メンバー管理、チーム目標設定など

4. **運勢関連API** - [fortune.md](./fortune.md)
   - デイリー運勢取得、運勢履歴、ランキングなど

5. **AIチャットAPI** - [chat.md](./chat.md)
   - メッセージ送信、履歴取得、チャットモード切替など

6. **管理者API** - [admin.md](./admin.md)
   - ユーザー管理、運勢更新設定、システム統計など

## 共通仕様

### ベースURL

```
https://dailyfortune-api-235426778039.asia-northeast1.run.app/api/v1
```

### 認証方式

すべてのAPIエンドポイント（一部の公開エンドポイントを除く）には認証が必要です。Firebase IDトークンをAuthorizationヘッダーに含める必要があります。

```
Authorization: Bearer <firebase-id-token>
```

### レスポンス形式

成功時のレスポンス形式:

```json
{
  "data": { ... },  // リクエストの結果データ
  "metadata": { ... }  // ページネーション情報など（該当する場合）
}
```

エラー時のレスポンス形式:

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "エラーメッセージ",
    "details": {}  // オプションの追加情報
  }
}
```

### 共通エラーコード

- `UNAUTHORIZED`: 認証されていない（401）
- `FORBIDDEN`: 権限がない（403）
- `NOT_FOUND`: リソースが見つからない（404）
- `VALIDATION_ERROR`: 入力検証エラー（400）
- `INTERNAL_SERVER_ERROR`: サーバー内部エラー（500）

### ページネーション

リスト取得APIではページネーションをサポートしています。以下のクエリパラメータを使用できます：

- `page`: ページ番号（デフォルト: 1）
- `limit`: 1ページあたりの件数（デフォルト: 20、最大: 100）

レスポンスには以下のようなメタデータが含まれます：

```json
{
  "data": [ ... ],
  "metadata": {
    "total": 100,  // 総件数
    "page": 1,     // 現在のページ
    "limit": 20,   // 1ページあたりの件数
    "pages": 5     // 総ページ数
  }
}
```

## API規約と開発フロー

APIの開発と更新は以下の流れで行います：

1. API設計書の更新（本ディレクトリ内の該当ファイル）
2. 共有定義の更新（`shared/index.ts`）
3. バックエンド用定義のコピー更新（`server/src/types/index.ts`）
4. バックエンド実装（ルートとコントローラー）
5. 実認証テストの実行
6. フロントエンド実装

詳細な規約については [CLAUDE.md](../../CLAUDE.md) の「API開発とテスト規約」セクションを参照してください。