# ラッキーアイテム生成テスト結果

このドキュメントでは、Claude APIを使用したラッキーアイテム生成機能のテスト結果を記録しています。

## テスト概要

四柱推命のユーザー属性（五行）と日柱情報を基に、Claude APIを使って以下のラッキーアイテムを生成：
- ラッキーファッション（color）
- ラッキーフード（item）
- ラッキードリンク（drink）

テスト日時: 2025年4月12日

## システムプロンプト

以下のシステムプロンプトを使用してClaudeに指示を与えました：

```
あなたは四柱推命に基づいたラッキーアイテム生成システムです。
ユーザーの五行属性（木・火・土・金・水）と日柱の五行属性に基づいて、その日のラッキーアイテムを提案します。

【ラッキーアイテム生成の原則】
1. 五行属性の相性に基づくラッキーアイテムを提案する
2. その日の運勢傾向に合わせたアイテムを選ぶ
3. 具体的で実用的なアイテムを提案する
4. 以下のフォーマットに厳密に従って回答する

【回答フォーマット】
必ず以下の3行のフォーマットで回答してください。各行は必ず「ラッキーファッション:」「ラッキーフード:」「ラッキードリンク:」から始めてください。
フォーマット例:
ラッキーファッション: [具体的なファッションアイテムや色]
ラッキーフード: [具体的な食べ物]
ラッキードリンク: [具体的な飲み物]

【重要】
- 必ず指定されたフォーマットを守ってください
- 余分な説明や追加情報は入れないでください
- 各アイテムの説明は具体的かつ簡潔にしてください
- JSON形式にはしないでください
- フォーマット外の追加情報は記載しないでください
```

## テストケース詳細

### テストケース 1: 木属性・高運勢

**入力情報:**
- ユーザー五行: 木
- 天干: 甲 (木)
- 地支: 寅 (木)
- 運勢スコア: 85

**生成されたラッキーアイテム:**
```
ラッキーファッション: 深緑色のアクセサリーか靴
ラッキーフード: 新鮮な葉野菜を使ったサラダ
ラッキードリンク: ハーブティーか緑茶
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "深緑色のアクセサリーか靴",
    "item": "新鮮な葉野菜を使ったサラダ",
    "drink": "ハーブティーか緑茶"
  }
}
```

### テストケース 2: 火属性・好調

**入力情報:**
- ユーザー五行: 火
- 天干: 丙 (火)
- 地支: 午 (火)
- 運勢スコア: 70

**生成されたラッキーアイテム:**
```
ラッキーファッション: 赤やオレンジのアクセント小物
ラッキーフード: グリルチキン
ラッキードリンク: ハイビスカスティー
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "赤やオレンジのアクセント小物",
    "item": "グリルチキン",
    "drink": "ハイビスカスティー"
  }
}
```

### テストケース 3: 土属性・普通

**入力情報:**
- ユーザー五行: 土
- 天干: 戊 (土)
- 地支: 辰 (土)
- 運勢スコア: 55

**生成されたラッキーアイテム:**
```
ラッキーファッション: 黄色やベージュのアクセサリー
ラッキーフード: カボチャの煮物
ラッキードリンク: 麦茶
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "黄色やベージュのアクセサリー",
    "item": "カボチャの煮物",
    "drink": "麦茶"
  }
}
```

### テストケース 4: 金属性・やや不調

**入力情報:**
- ユーザー五行: 金
- 天干: 庚 (金)
- 地支: 申 (金)
- 運勢スコア: 35

**生成されたラッキーアイテム:**
```
ラッキーファッション: 赤やピンクのアクセサリーや小物
ラッキーフード: スパイシーなトマトパスタ
ラッキードリンク: ハイビスカスティー
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "赤やピンクのアクセサリーや小物",
    "item": "スパイシーなトマトパスタ",
    "drink": "ハイビスカスティー"
  }
}
```

### テストケース 5: 水属性・不調

**入力情報:**
- ユーザー五行: 水
- 天干: 壬 (水)
- 地支: 子 (水)
- 運勢スコア: 15

**生成されたラッキーアイテム:**
```
ラッキーファッション: 土色やベージュ系の靴下や手袋
ラッキーフード: 乾燥豆や玄米を使った料理
ラッキードリンク: ほうじ茶や黒豆茶
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "土色やベージュ系の靴下や手袋",
    "item": "乾燥豆や玄米を使った料理",
    "drink": "ほうじ茶や黒豆茶"
  }
}
```

### テストケース 6: 木属性と金属性の相克関係・絶好調

**入力情報:**
- ユーザー五行: 木
- 天干: 辛 (金)
- 地支: 酉 (金)
- 運勢スコア: 90

**生成されたラッキーアイテム:**
```
ラッキーファッション: 白や銀のアクセサリーとベージュ系の服
ラッキーフード: 根菜類のサラダ（ごぼう、人参、蓮根）
ラッキードリンク: ジンジャーエール
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "白や銀のアクセサリーとベージュ系の服",
    "item": "根菜類のサラダ（ごぼう、人参、蓮根）",
    "drink": "ジンジャーエール"
  }
}
```

### テストケース 7: 火属性と水属性の相克関係・不調

**入力情報:**
- ユーザー五行: 火
- 天干: 癸 (水)
- 地支: 子 (水)
- 運勢スコア: 10

**生成されたラッキーアイテム:**
```
ラッキーファッション: 赤やオレンジ色の暖色系アクセサリー
ラッキーフード: スパイシーなカレーまたは唐辛子入り料理
ラッキードリンク: ジンジャーティーまたはシナモン入りホットワイン
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "赤やオレンジ色の暖色系アクセサリー",
    "item": "スパイシーなカレーまたは唐辛子入り料理",
    "drink": "ジンジャーティーまたはシナモン入りホットワイン"
  }
}
```

### テストケース 8: 金属性・普通

**入力情報:**
- ユーザー五行: 金
- 天干: 丁 (火)
- 地支: 卯 (木)
- 運勢スコア: 60

**生成されたラッキーアイテム:**
```
ラッキーファッション: 赤やオレンジの小物やアクセサリー
ラッキーフード: きのこのリゾット
ラッキードリンク: ローズヒップティー
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "赤やオレンジの小物やアクセサリー",
    "item": "きのこのリゾット",
    "drink": "ローズヒップティー"
  }
}
```

### テストケース 9: 水属性・やや不調

**入力情報:**
- ユーザー五行: 水
- 天干: 己 (土)
- 地支: 未 (土)
- 運勢スコア: 45

**生成されたラッキーアイテム:**
```
ラッキーファッション: ブラウンまたはベージュのスカーフやネクタイ
ラッキーフード: さつまいものスイーツやお菓子
ラッキードリンク: ジャスミンティーまたは麦茶
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "ブラウンまたはベージュのスカーフやネクタイ",
    "item": "さつまいものスイーツやお菓子",
    "drink": "ジャスミンティーまたは麦茶"
  }
}
```

### テストケース 10: 土属性・不調

**入力情報:**
- ユーザー五行: 土
- 天干: 乙 (木)
- 地支: 亥 (水)
- 運勢スコア: 20

**生成されたラッキーアイテム:**
```
ラッキーファッション: 赤色やオレンジ色のストールやマフラー
ラッキーフード: 焼き芋や根菜のロースト料理
ラッキードリンク: シナモンティーまたはジンジャーティー
```

**DB保存形式:**
```json
{
  "luckyItems": {
    "color": "赤色やオレンジ色のストールやマフラー",
    "item": "焼き芋や根菜のロースト料理",
    "drink": "シナモンティーまたはジンジャーティー"
  }
}
```

## 分析と考察

### 成功点
1. **フォーマット一貫性**: すべてのレスポンスが指定されたフォーマットに従っており、パースが容易
2. **五行属性の反映**: ユーザーの五行属性と日柱の五行相性を考慮したアイテム生成ができている
3. **運勢スコア適応**: 運勢スコアに応じて異なる提案がされており、意味のある内容になっている
4. **具体性**: 「赤やオレンジのアクセント小物」「スパイシーなカレー」など具体的な提案ができている
5. **多様性**: 固定テンプレートより多様性に富んだ提案が可能

### 実装のポイント
1. **単純なフォーマット**: JSONよりもシンプルなテキスト形式でのレスポンスとパースが効果的
2. **アイテム名の適切さ**: 「ラッキーファッション」「ラッキーフード」「ラッキードリンク」という名前づけが適切
3. **正確なパース**: 全ケースで正確にパースできている
4. **バックアップ機構**: API呼び出し失敗時のフォールバック機構も必要

## 実装提案

現在の実装から、以下の変更を提案します：

1. Claude APIを使用してテキスト形式でラッキーアイテムを生成
2. 既存のデータベースモデル構造（`luckyItems.color`, `luckyItems.item`, `luckyItems.drink`）はそのまま維持
3. フロントエンド表示の「ラッキーファッション」「ラッキーフード」「ラッキードリンク」も既に適切
4. API障害時は現在のテンプレートベース生成にフォールバック

テスト結果を見る限り、このアプローチは安定して機能し、より魅力的で多様なラッキーアイテム提案が可能になります。

## テストスクリプト

テストに使用したスクリプトは以下の場所に保存されています：
`/Users/tatsuya/Desktop/システム開発/DailyFortune/server/scripts/test-lucky-items/test-lucky-items.js`